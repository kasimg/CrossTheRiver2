{"version":3,"sources":["MainScript.js"],"names":["cc","Class","extends","Component","properties","animalPrefab","default","type","Prefab","tigers","deers","boat","Node","riverBankInfo","GoBtn","rulesBtn","Label","ruleContext","RichText","creatActors","i","tiger","instantiate","loader","loadRes","SpriteFrame","err","spriteFrame","getComponent","Sprite","mainScript","animalIndex","animalType","node","addChild","push","deer","setActorPos","length","posX","Data","tigerPositionLeft","x","posY","y","setPosition","deerPositionLeft","boatPositionLeft","initRiverBankInfo","left","tigerNum","deerNum","right","initBackground","bindGoEvent","on","EventType","MOUSE_DOWN","onGoBtnClicked","removeGoEvent","off","onMouseEnter","game","canvas","style","cursor","scale","onMouseLeave","bindEnterAndLeave","MOUSE_ENTER","MOUSE_LEAVE","hasDeer","Math","abs","sailTo","ifGameOver","gameOver","removeAnimalClickEvent","removeClickEvent","bindAnimalClickEvent","bindClickEvent","pos","allTheWay","boatIns","boatStr","passageStr","boatSailAction","sail","delX","delY","se","sequence","callFunc","console","log","runAction","passages","seats","seatIndex","state","boatInfo","boatStatus","addFlag","forEach","atLeft","onBoat","passage","eatAction","eatDeer","opacity","director","loadScene","ifSucceeded","succeed","showRules","tween","to","start","onRulesBtnClick","onRulesBtnHover","onRulesBtnLeave","bindRulesBtnEvent","onLoad","zindex","update","dt"],"mappings":"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","file":"MainScript.js","sourceRoot":"..\\..\\..\\..\\assets\\Script","sourcesContent":["// Learn cc.Class:\r\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/class.html\r\n//  - [English] http://docs.cocos2d-x.org/creator/manual/en/scripting/class.html\r\n// Learn Attribute:\r\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/reference/attributes.html\r\n//  - [English] http://docs.cocos2d-x.org/creator/manual/en/scripting/reference/attributes.html\r\n// Learn life-cycle callbacks:\r\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/life-cycle-callbacks.html\r\n//  - [English] https://www.cocos2d-x.org/docs/creator/manual/en/scripting/life-cycle-callbacks.html\r\nimport Data from 'Data';\r\ncc.Class({\r\n  extends: cc.Component,\r\n\r\n  properties: {\r\n    animalPrefab: {\r\n      default: null,\r\n      type: cc.Prefab,\r\n    },\r\n    // deerPrefab: {\r\n    //   default: null,\r\n    //   type: cc.Prefab,\r\n    // },\r\n    tigers: [],  //  存放3只老虎\r\n    deers: [],  //  存放3只鹿\r\n    boat: {\r\n      default: null,\r\n      type: cc.Node,\r\n    },\r\n    riverBankInfo: {\r\n      default: null,\r\n    },  //  存放两边岸上的情况\r\n    GoBtn: {\r\n      default: null,\r\n      type: cc.Node,\r\n    },\r\n    rulesBtn: {  //  点击弹出游戏规则\r\n      default: null,\r\n      type: cc.Label,\r\n    },\r\n    ruleContext: {\r\n      default: null,\r\n      type: cc.RichText,\r\n    }\r\n  },\r\n\r\n  //  创建角色\r\n  creatActors() {\r\n    //  创建老虎\r\n    for (let i = 0; i < 3; i++) {\r\n      //  创建老虎\r\n      const tiger = cc.instantiate(this.animalPrefab);\r\n      cc.loader.loadRes('tiger', cc.SpriteFrame, (err, spriteFrame) => {\r\n        tiger.getComponent(cc.Sprite).spriteFrame = spriteFrame;\r\n      });\r\n\r\n      tiger.getComponent('Animal').mainScript = this;\r\n      tiger.getComponent('Animal').animalIndex = i;\r\n      tiger.getComponent('Animal').animalType = 'tiger';\r\n      this.node.addChild(tiger);\r\n      this.tigers.push(tiger);\r\n    }\r\n\r\n    //  创建鹿\r\n    for (let i = 0; i < 3; i++) {\r\n      //  创建鹿\r\n      const deer = cc.instantiate(this.animalPrefab);\r\n      cc.loader.loadRes('deer', cc.SpriteFrame, (err, spriteFrame) => {\r\n        deer.getComponent(cc.Sprite).spriteFrame = spriteFrame;\r\n      });\r\n\r\n      deer.getComponent('Animal').mainScript = this;\r\n      deer.getComponent('Animal').animalIndex = i;\r\n      deer.getComponent('Animal').animalType = 'deer';\r\n      this.node.addChild(deer);\r\n      this.deers.push(deer);\r\n    }\r\n  },\r\n\r\n  //  设置老虎和鹿的初始位置\r\n  setActorPos() {\r\n    for (let i = 0; i < this.tigers.length; i++) {\r\n      const tiger = this.tigers[i];\r\n      let posX = Data.tigerPositionLeft[i].x;\r\n      let posY = Data.tigerPositionLeft[i].y;\r\n\r\n      // tiger.x = posX;\r\n      // tiger.y = posY;\r\n\r\n      tiger.setPosition(posX, posY);\r\n\r\n      const deer = this.deers[i];\r\n      posX = Data.deerPositionLeft[i].x;\r\n      posY = Data.deerPositionLeft[i].y;\r\n\r\n      // deer.x = posX;\r\n      // deer.y = posY;\r\n      // console.log(deer.x, deer.y);\r\n      deer.setPosition(posX, posY);\r\n\r\n    }\r\n\r\n    //  设置船的初始位置\r\n    this.boat.setPosition(Data.boatPositionLeft.x, Data.boatPositionLeft.y);\r\n  },\r\n\r\n  //  初始化河岸数组\r\n  initRiverBankInfo() {\r\n    this.riverBankInfo = {\r\n      left: {\r\n        tigerNum: 3,\r\n        deerNum: 3,\r\n      },\r\n      right: {\r\n        tigerNum: 0,\r\n        deerNum: 0,\r\n      },\r\n    };\r\n  },\r\n\r\n  //  初始化界面\r\n  initBackground() {\r\n    this.creatActors();\r\n    this.setActorPos();\r\n    this.initRiverBankInfo();\r\n  },\r\n\r\n  //  绑定GO按钮点击事件\r\n  bindGoEvent() {\r\n    this.GoBtn.on(cc.Node.EventType.MOUSE_DOWN, this.onGoBtnClicked, this);\r\n  },\r\n\r\n  //  解除GO按钮点击事件\r\n  removeGoEvent() {\r\n    this.GoBtn.off(cc.Node.EventType.MOUSE_DOWN, this.onGoBtnClicked, this);\r\n  },\r\n\r\n  //  鼠标悬停事件\r\n  onMouseEnter() {\r\n    cc.game.canvas.style.cursor = 'pointer';\r\n    this.GoBtn.scale = 0.21;\r\n    // this.GoBtn.runAction(cc.scaleBy(0.2, 1.2));\r\n  },\r\n\r\n  //  鼠标离开事件\r\n  onMouseLeave() {\r\n    cc.game.canvas.style.cursor = 'default';\r\n    this.GoBtn.scale = 0.19;\r\n    // this.GoBtn.runAction(cc.scaleBy(0.2, 5 / 6));\r\n  },\r\n\r\n  //  绑定悬停和离开事件\r\n  bindEnterAndLeave() {\r\n    this.GoBtn.on(cc.Node.EventType.MOUSE_ENTER, this.onMouseEnter, this);\r\n    this.GoBtn.on(cc.Node.EventType.MOUSE_LEAVE, this.onMouseLeave, this);\r\n  },\r\n\r\n  //  注销悬停和离开事件\r\n\r\n  //  点击GO之后的事件\r\n  onGoBtnClicked() {\r\n    // console.log('点击了一次');\r\n    if (this.boat.getComponent('Boat').hasDeer()) {  //  只有船上有鹿的时候才能开船\r\n      //  根据船的位置确定往哪里走，实际操作中有可能出现误差，所以这里给出一定的余地\r\n      if (Math.abs(this.boat.x - Data.boatPositionLeft.x) < 10) {  //  如果在左边\r\n        //  移动船\r\n        this.sailTo('right');\r\n        //  离开左岸的判定\r\n        if (this.ifGameOver('left', 'leave')) {\r\n          this.gameOver('left', 'leave');\r\n        }\r\n      } else {\r\n        this.sailTo('left');\r\n        //  离开右岸的判定\r\n        if (this.ifGameOver('right', 'leave')) {\r\n          this.gameOver('right', 'leave');\r\n        }\r\n      }\r\n    }\r\n  },\r\n\r\n  //  移除所有动物的点击事件\r\n  removeAnimalClickEvent() {\r\n    // console.log('remove');\r\n    for (let i = 0; i < this.tigers.length; i++) {\r\n      this.tigers[i].getComponent('Animal').removeClickEvent();\r\n      this.deers[i].getComponent('Animal').removeClickEvent();\r\n    }\r\n  },\r\n\r\n  //  绑定多有动物的点击事件\r\n  bindAnimalClickEvent() {\r\n    for (let i = 0; i < this.tigers.length; i++) {\r\n      this.tigers[i].getComponent('Animal').bindClickEvent();\r\n      this.deers[i].getComponent('Animal').bindClickEvent();\r\n    }\r\n  },\r\n\r\n  /**\r\n   * 向指定方向航行指定的路程\r\n   * @param {string} pos \b航行的方向，可以为'left'或者’right‘\r\n   * @param {boolean} allTheWay 是否航行全程，默认为true\r\n   */\r\n  sailTo(pos, allTheWay = true) {\r\n    const boatIns = this.boat.getComponent('Boat');\r\n    const boatStr = 'boatPosition' + (pos === 'right' ? 'Right' : 'Left');\r\n    const passageStr = pos + 'Pos';\r\n    // console.log(Data[boatStr], boatStr);\r\n    // console.log(pos);\r\n    // console.log('从', {x: this.boat.x, y: this.boat.y}, '开往', Data[boatStr])\r\n    const boatSailAction = boatIns.sail({\r\n      delX: Data[boatStr].x - this.boat.x,\r\n      delY: Data[boatStr].y - this.boat.y,\r\n    });\r\n\r\n    //  移除点击事件，防止连续点击\r\n    this.removeGoEvent();\r\n    this.removeAnimalClickEvent();\r\n    // const actionArr = [];\r\n    // actionArr.push(boatSailAction);\r\n    const se = cc.sequence(boatSailAction, cc.callFunc(() => {\r\n      // console.log('动作执行完毕');\r\n      //  动作执行完之后，重新绑定事件\r\n      this.bindGoEvent();\r\n      this.bindAnimalClickEvent();\r\n\r\n      console.log(this.riverBankInfo);\r\n      //  判断是否游戏结束\r\n      if (this.ifGameOver(pos, 'arrive')) {\r\n        this.gameOver(pos, 'arrive');\r\n      } else {\r\n        console.log('继续');\r\n      }\r\n    }, this));\r\n    this.boat.runAction(se);\r\n\r\n    const passages = boatIns.passages;\r\n    // if (!boatIns.isEmpty()) {\r\n    for (let i = 0; i < passages.length; i++) {\r\n      if (passages[i]) {\r\n        passages[i].sail({\r\n          delX: boatIns.seats[passages[i].seatIndex][passageStr].x - passages[i].node.x,\r\n          delY: boatIns.seats[passages[i].seatIndex][passageStr].y - passages[i].node.y,\r\n        });\r\n      }\r\n\r\n    }\r\n    // }\r\n  },\r\n\r\n  // 判定游戏是否结束\r\n  //  pos表示判断哪一岸的情况\r\n  //  state表示离岸还是靠岸\r\n  ifGameOver(pos, state) {\r\n    const boatInfo = this.boat.getComponent('Boat');\r\n    // console.log(this.riverBankInfo, boatInfo);\r\n    if (state === 'leave') { //  离开岸边，不用加上船上的动物数量\r\n      if (this.riverBankInfo[pos].deerNum < 1) return false;  //  如果没有鹿，不可能游戏结束\r\n      if (this.riverBankInfo[pos].tigerNum > this.riverBankInfo[pos].deerNum) return true;\r\n    } else {\r\n      if (this.riverBankInfo[pos].deerNum + boatInfo.boatInfo.deerNum < 1) return false;\r\n      if (this.riverBankInfo[pos].tigerNum + boatInfo.boatInfo.tigerNum\r\n        > this.riverBankInfo[pos].deerNum + boatInfo.boatInfo.deerNum) return true;\r\n    }\r\n    return false;\r\n  },\r\n\r\n  //  游戏结束时执行\r\n  /**\r\n   * \r\n   * @param {string} pos 左岸发生还是右岸发生，值为'left'或者'right'\r\n   * @param {string} boatStatus 船的状态，可以为’arrive‘或者’leave‘\r\n   */\r\n  gameOver(pos, boatStatus) {\r\n    const tigers = [];\r\n    const deers = [];\r\n    // console.log(pos, boatStatus);\r\n    const addFlag = true;\r\n    if (pos === 'left') {\r\n      //  获取岸上的老虎对象\r\n      this.tigers.forEach((tiger) => {\r\n        if (tiger.getComponent('Animal').atLeft()) tigers.push(tiger);\r\n      });\r\n      //  获取岸上的鹿对象\r\n      this.deers.forEach((deer) => {\r\n        if (deer.getComponent('Animal').atLeft()) deers.push(deer);\r\n      });\r\n    } else {\r\n      //  获取岸上的老虎对象\r\n      this.tigers.forEach((tiger) => {\r\n        if (!tiger.getComponent('Animal').atLeft() && !tiger.getComponent('Animal').onBoat) tigers.push(tiger);\r\n      });\r\n      //  获取岸上的鹿对象\r\n      this.deers.forEach((deer) => {\r\n        if (!deer.getComponent('Animal').atLeft() && !deer.getComponent('Animal').onBoat) deers.push(deer);\r\n      });\r\n    }\r\n\r\n    if (boatStatus === 'arrive') {  //  到达左岸的情形\r\n      // console.log('到达岸边');\r\n      //  把船上的动物也加上\r\n      // console.log(this.boat.getComponent('Boat').passages);\r\n      this.boat.getComponent('Boat').passages.forEach((passage) => {\r\n        if (passage) {\r\n          if (passage.animalType === 'tiger') {\r\n            tigers.push(passage.node);\r\n          } else {\r\n            deers.push(passage.node);\r\n          }\r\n        }\r\n      });\r\n    } \r\n\r\n    //  播放老虎吃鹿的动画\r\n    console.log(tigers, deers);\r\n    for (let i = 0; i < deers.length; i++) {\r\n      // console.log(deers[i].x, tigers[i].x);\r\n      const eatAction = tigers[i].getComponent('Animal').eatDeer({\r\n        delX: deers[i].x - tigers[i].x,\r\n        delY: deers[i].y - tigers[i].y,\r\n      });\r\n      const se = cc.sequence(eatAction, cc.callFunc(() => {\r\n        // console.log('eating finished');\r\n        deers[i].opacity = 0;\r\n        if (i === 0) cc.director.loadScene('gameOver');\r\n      }, this));\r\n\r\n      tigers[i].runAction(se);\r\n    }\r\n    // cc.director.loadScene('gameOver');\r\n  },\r\n\r\n  //  判断是否胜利\r\n  ifSucceeded() {\r\n    //  如果右岸动物总数达到6，则胜利\r\n    if (this.riverBankInfo.right.tigerNum + this.riverBankInfo.right.deerNum === 6) return true;\r\n    return false;\r\n  },\r\n\r\n  //  胜利后执行的操作\r\n  succeed() {\r\n    cc.director.loadScene('succeed');\r\n  },\r\n\r\n  //  弹出提示\r\n  showRules() {\r\n    // const ruleOpacity = this.ruleContext.node.opacity;\r\n    const opacity = this.ruleContext.node.opacity === 255 ? 0 : 255;\r\n    cc.tween(this.ruleContext.node)\r\n    .to(0.5, {opacity: opacity})\r\n    .start();\r\n  },\r\n\r\n  //  点击游戏规则按钮的事件\r\n  onRulesBtnClick() {\r\n    this.showRules();\r\n  },\r\n\r\n  onRulesBtnHover() {\r\n    cc.game.canvas.style.cursor = 'pointer';\r\n  },\r\n\r\n  onRulesBtnLeave() {\r\n    cc.game.canvas.style.cursor = 'default';\r\n  },\r\n\r\n  //  绑定游戏规则按钮事件\r\n  bindRulesBtnEvent() {\r\n    this.rulesBtn.node.on(cc.Node.EventType.MOUSE_DOWN, this.onRulesBtnClick, this);\r\n    this.rulesBtn.node.on(cc.Node.EventType.MOUSE_ENTER, this.onRulesBtnHover, this);\r\n    this.rulesBtn.node.on(cc.Node.EventType.MOUSE_LEAVE, this.onRulesBtnLeave, this);\r\n  },\r\n\r\n  onLoad() {\r\n    this.initBackground();\r\n    this.bindGoEvent();\r\n    this.bindEnterAndLeave();\r\n    this.bindRulesBtnEvent();\r\n    this.ruleContext.node.opacity = 0;\r\n    this.ruleContext.node.zindex = 99;\r\n    // cc.game.addPersistRootNode(this.node);\r\n    // console.log(this.tigers[0]);\r\n    // console.log(this.tigers[0]);\r\n    // this.tigers[0].getComponent('Animal').jump();\r\n  },\r\n\r\n  start() {\r\n\r\n  },\r\n\r\n  update(dt) {\r\n    // console.log(this.tigers[0]);\r\n    // this.tigers[0].getComponent('Animal').jump();\r\n  },\r\n});\r\n"]}