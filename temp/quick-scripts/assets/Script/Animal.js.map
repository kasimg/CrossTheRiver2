{"version":3,"sources":["Animal.js"],"names":["cc","Class","extends","Component","properties","atLeft","leftPos","animalType","Data","tigerPositionLeft","animalIndex","deerPositionLeft","Math","abs","node","x","jump","delX","delY","jumpAction","moveBy","v2","easing","easeCubicActionOut","runAction","getOnTheBoatFrom","pos","boat","mainScript","getComponent","seatIndex","searchSeat","getOn","computeDelPos","y","seats","getOffTheBoatFrom","getOff","animalStr","directionStr","updateAnimalNum","bankInfo","riverBankInfo","boatInfo","addFlag","sail","sailAction","onClicked","onBoat","xBefore","yBefore","xAfter","yAfter","bindClickEvent","on","Node","EventType","MOUSE_DOWN","removeClickEvent","onLoad","start"],"mappings":"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","file":"Animal.js","sourceRoot":"..\\..\\..\\..\\assets\\Script","sourcesContent":["// Learn cc.Class:\r\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/class.html\r\n//  - [English] http://docs.cocos2d-x.org/creator/manual/en/scripting/class.html\r\n// Learn Attribute:\r\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/reference/attributes.html\r\n//  - [English] http://docs.cocos2d-x.org/creator/manual/en/scripting/reference/attributes.html\r\n// Learn life-cycle callbacks:\r\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/life-cycle-callbacks.html\r\n//  - [English] https://www.cocos2d-x.org/docs/creator/manual/en/scripting/life-cycle-callbacks.html\r\n\r\nimport Data from 'static/Data';\r\ncc.Class({\r\n  extends: cc.Component,\r\n\r\n  properties: {\r\n\r\n  },\r\n\r\n  //  判断是否在左岸\r\n  atLeft() {\r\n    //  根据动物类型和创建时的索引确定左岸自己的位置\r\n    const leftPos = this.animalType === 'tiger'\r\n      ? Data.tigerPositionLeft[this.animalIndex]\r\n      : Data.deerPositionLeft[this.animalIndex];\r\n\r\n    if (Math.abs(this.node.x - leftPos.x) < 10) return true;\r\n    return false;\r\n  },\r\n\r\n  //  跳跃行为\r\n  jump({ delX = 0, delY = 0 }) {\r\n    // console.log('jump')\r\n    const jumpAction = cc\r\n      .moveBy(1, cc.v2(delX, delY))\r\n      .easing(cc.easeCubicActionOut());\r\n\r\n    this.node.runAction(jumpAction);\r\n    // this.computeDelPos();\r\n  },\r\n\r\n  //  上船行为\r\n  getOnTheBoatFrom(pos) {\r\n    const boat = this.mainScript.boat.getComponent('Boat');\r\n    // const bankInfo = \r\n    const seatIndex = boat.searchSeat();\r\n    if (seatIndex !== -1) {\r\n      boat.getOn(this, seatIndex);\r\n      // console.log('get on the boat');\r\n      //  跳上船\r\n      this.jump(this.computeDelPos({ x: this.node.x, y: this.node.y }, boat.seats[this.seatIndex][pos === 'left' ? 'leftPos' : 'rightPos']));\r\n      //  更新岸上和船上的动物数量信息\r\n    }\r\n  },\r\n\r\n  //  下船行为\r\n  getOffTheBoatFrom(pos) {\r\n    const boat = this.mainScript.boat.getComponent('Boat');\r\n    // console.log('get off the boat');\r\n    boat.getOff(this, this.seatIndex);\r\n\r\n    //  跳下船\r\n    const animalStr = this.animalType === 'tiger' ? 'tigerPosition' : 'deerPosition';\r\n    const directionStr = pos === 'left' ? 'Left' : 'Right';\r\n    this.jump(this.computeDelPos(\r\n      { x: this.node.x, y: this.node.y },\r\n      Data[animalStr + directionStr][this.animalIndex],\r\n    ));\r\n  },\r\n\r\n  //  更新船上和岸上的动物数量信息\r\n  //  getOn表示是否往船上跳，默认为true\r\n  updateAnimalNum(pos, getOn = true) {\r\n    const bankInfo = this.mainScript.riverBankInfo;\r\n    const boatInfo = this.mainScript.boat.getComponent('Boat').boatInfo;\r\n    // console.log(bankInfo, boatInfo, this.mainScript.boat.getComponent('Boat'));\r\n\r\n    const animalStr = this.animalType + 'Num';\r\n    const addFlag = getOn ? 1 : -1;\r\n    bankInfo[pos][animalStr] -= 1 * addFlag;\r\n    boatInfo[animalStr] += 1 * addFlag;\r\n\r\n    // console.log(bankInfo, boatInfo);\r\n  },\r\n\r\n  //  点击GO之后的移动行为\r\n  sail({ delX, delY }) {\r\n    const sailAction = cc\r\n      .moveBy(1, cc.v2(delX, delY))\r\n      .easing(cc.easeCubicActionOut());\r\n\r\n    this.node.runAction(sailAction);\r\n  },\r\n\r\n  //  点击精灵的相应事件\r\n  //  决定是上船还是下船，应该往哪里跳\r\n  onClicked() {\r\n    // console.log('动物被点击');\r\n    //  存放boat\r\n    const boat = this.mainScript.boat.getComponent('Boat');\r\n    // this.atLeft();\r\n    // console.log(boat.atLeft());\r\n    //  如果船在左岸\r\n    // console.log(this.onBoat);\r\n    if (boat.atLeft()) {\r\n      // console.log('船在左岸');\r\n      // console.log(this.onBoat);\r\n      if (this.onBoat) {  //  此时一定是在船上，而且是在左边\r\n        // console.log('动物在船上');\r\n        this.getOffTheBoatFrom('left');\r\n        this.updateAnimalNum('left', false);\r\n      } else if (this.atLeft()) {  //  否则在岸上\r\n        // console.log('动物在岸上');\r\n        this.getOnTheBoatFrom('left');\r\n        this.updateAnimalNum('left');\r\n      }\r\n    } else {  //  船在右岸\r\n      // console.log('船在右岸');\r\n      if (this.onBoat) {  //  在船上，且在右边\r\n        this.getOffTheBoatFrom('right');\r\n        this.updateAnimalNum('right', false);\r\n      } else if (!this.atLeft()) {  //  不在船上，在右岸上\r\n        // console.log('动物在右岸')\r\n        this.getOnTheBoatFrom('right');\r\n        this.updateAnimalNum('right');\r\n      }\r\n    }\r\n  },\r\n\r\n  //  计算位移量\r\n  computeDelPos({ x: xBefore, y: yBefore }, { x: xAfter, y: yAfter }) {\r\n    return {\r\n      delX: xAfter - xBefore,\r\n      delY: yAfter - yBefore,\r\n    };\r\n  },\r\n\r\n  //  绑定鼠标点击跳跃时间\r\n  bindClickEvent() {\r\n    this.node.on(cc.Node.EventType.MOUSE_DOWN, this.onClicked, this);\r\n  },\r\n\r\n  //  移除鼠标点击事件\r\n  removeClickEvent() {\r\n    this.node.on(cc.Node.EventType.MOUSE_DOWN, this.onClicked, this);\r\n  },\r\n\r\n  // LIFE-CYCLE CALLBACKS:\r\n\r\n  onLoad() {\r\n    this.bindClickEvent();\r\n    // console.log(this.atLeft());\r\n  },\r\n\r\n  start() {\r\n\r\n  },\r\n\r\n  // update (dt) {},\r\n});\r\n"]}