{"version":3,"sources":["Animal.js"],"names":["cc","Class","extends","Component","properties","atLeft","leftPos","animalType","Data","tigerPositionLeft","animalIndex","deerPositionLeft","Math","abs","node","x","jump","delX","delY","jumpAction","moveBy","v2","easing","easeCubicActionOut","mainScript","removeAnimalClickEvent","runAction","sequence","callFunc","ifSucceeded","succeed","bindAnimalClickEvent","getOnTheBoatFrom","pos","boat","getComponent","seatIndex","searchSeat","getOn","computeDelPos","y","seats","getOffTheBoatFrom","getOff","animalStr","directionStr","updateAnimalNum","bankInfo","riverBankInfo","boatInfo","addFlag","sail","sailAction","onClicked","onBoat","xBefore","yBefore","xAfter","yAfter","bindClickEvent","on","Node","EventType","MOUSE_DOWN","removeClickEvent","off","onMouseEnter","game","canvas","style","cursor","action1","scaleBy","action2","removeMouseEnterEvent","se","bindMouseEnterEvent","soundType","parent","getChildByName","play","onMouseLeave","MOUSE_ENTER","MOUSE_LEAVE","eatDeer","eatAction","onLoad","start"],"mappings":"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","file":"Animal.js","sourceRoot":"../../../../assets/Script","sourcesContent":["// Learn cc.Class:\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/class.html\n//  - [English] http://docs.cocos2d-x.org/creator/manual/en/scripting/class.html\n// Learn Attribute:\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/reference/attributes.html\n//  - [English] http://docs.cocos2d-x.org/creator/manual/en/scripting/reference/attributes.html\n// Learn life-cycle callbacks:\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/life-cycle-callbacks.html\n//  - [English] https://www.cocos2d-x.org/docs/creator/manual/en/scripting/life-cycle-callbacks.html\n\nimport Data from 'Data';\ncc.Class({\n  extends: cc.Component,\n\n  properties: {\n\n  },\n\n  //  判断是否在左岸\n  atLeft() {\n    //  根据动物类型和创建时的索引确定左岸自己的位置\n    const leftPos = this.animalType === 'tiger'\n      ? Data.tigerPositionLeft[this.animalIndex]\n      : Data.deerPositionLeft[this.animalIndex];\n\n    if (Math.abs(this.node.x - leftPos.x) < 10) return true;\n    return false;\n  },\n\n  //  跳跃行为\n  jump({ delX = 0, delY = 0 }) {\n    // console.log('jump')\n    const jumpAction = cc\n      .moveBy(1, cc.v2(delX, delY))\n      .easing(cc.easeCubicActionOut());\n\n    //  先取消所有动物的点击事件，防止疯狂点击\n    this.mainScript.removeAnimalClickEvent();\n    this.node.runAction(cc.sequence(jumpAction, cc.callFunc(() => {\n      //  如果是开往右岸，则判断是否游戏胜利\n      if (this.mainScript.ifSucceeded()) {\n        this.mainScript.succeed();\n      }\n      //  恢复动物点击事件\n      this.mainScript.bindAnimalClickEvent();\n    }, this)));\n    // this.computeDelPos();\n  },\n\n  //  上船行为\n  getOnTheBoatFrom(pos) {\n    const boat = this.mainScript.boat.getComponent('Boat');\n    // const bankInfo = \n    const seatIndex = boat.searchSeat();\n    if (seatIndex !== -1) {\n      boat.getOn(this, seatIndex);\n      // console.log('get on the boat');\n      //  跳上船\n      this.jump(this.computeDelPos({ x: this.node.x, y: this.node.y }, boat.seats[this.seatIndex][pos === 'left' ? 'leftPos' : 'rightPos']));\n      //  更新岸上和船上的动物数量信息\n    }\n  },\n\n  //  下船行为\n  getOffTheBoatFrom(pos) {\n    const boat = this.mainScript.boat.getComponent('Boat');\n    // console.log('get off the boat');\n    boat.getOff(this, this.seatIndex);\n\n    //  跳下船\n    const animalStr = this.animalType === 'tiger' ? 'tigerPosition' : 'deerPosition';\n    const directionStr = pos === 'left' ? 'Left' : 'Right';\n    this.jump(this.computeDelPos(\n      { x: this.node.x, y: this.node.y },\n      Data[animalStr + directionStr][this.animalIndex],\n    ));\n  },\n\n  //  更新船上和岸上的动物数量信息\n  //  getOn表示是否往船上跳，默认为true\n  updateAnimalNum(pos, getOn = true) {\n    const bankInfo = this.mainScript.riverBankInfo;\n    const boatInfo = this.mainScript.boat.getComponent('Boat').boatInfo;\n    // console.log(bankInfo, boatInfo, this.mainScript.boat.getComponent('Boat'));\n\n    const animalStr = this.animalType + 'Num';\n    const addFlag = getOn ? 1 : -1;\n    bankInfo[pos][animalStr] -= 1 * addFlag;\n    boatInfo[animalStr] += 1 * addFlag;\n\n    // console.log(bankInfo, boatInfo);\n  },\n\n  //  点击GO之后的移动行为\n  sail({ delX, delY }) {\n    const sailAction = cc\n      .moveBy(1, cc.v2(delX, delY))\n      .easing(cc.easeCubicActionOut());\n\n    this.node.runAction(sailAction);\n    // return sailAction;\n  },\n\n  //  点击精灵的相应事件\n  //  决定是上船还是下船，应该往哪里跳\n  onClicked() {\n    // console.log('动物被点击');\n    //  存放boat\n    const boat = this.mainScript.boat.getComponent('Boat');\n    // this.atLeft();\n    // console.log(boat.atLeft());\n    //  如果船在左岸\n    // console.log(this.onBoat);\n    if (boat.atLeft()) {\n      // console.log('船在左岸');\n      // console.log(this.onBoat);\n      if (this.onBoat) {  //  此时一定是在船上，而且是在左边\n        // console.log('动物在船上');\n        this.getOffTheBoatFrom('left');\n        this.updateAnimalNum('left', false);\n      } else if (this.atLeft()) {  //  否则在岸上\n        // console.log('动物在岸上');\n        this.getOnTheBoatFrom('left');\n        this.updateAnimalNum('left');\n      }\n    } else {  //  船在右岸\n      // console.log('船在右岸');\n      if (this.onBoat) {  //  在船上，且在右边\n        this.getOffTheBoatFrom('right');\n        this.updateAnimalNum('right', false);\n      } else if (!this.atLeft()) {  //  不在船上，在右岸上\n        // console.log('动物在右岸')\n        this.getOnTheBoatFrom('right');\n        this.updateAnimalNum('right');\n      }\n    }\n  },\n\n  //  计算位移量\n  computeDelPos({ x: xBefore, y: yBefore }, { x: xAfter, y: yAfter }) {\n    return {\n      delX: xAfter - xBefore,\n      delY: yAfter - yBefore,\n    };\n  },\n\n  //  绑定鼠标点击跳跃事件\n  bindClickEvent() {\n    this.node.on(cc.Node.EventType.MOUSE_DOWN, this.onClicked, this);\n  },\n\n  //  移除鼠标点击事件\n  removeClickEvent() {\n    this.node.off(cc.Node.EventType.MOUSE_DOWN, this.onClicked, this);\n  },\n\n  //  鼠标移动到动物身上后的事件\n  onMouseEnter() {\n    cc.game.canvas.style.cursor = 'pointer';\n    //  弹跳效果\n    const action1 = cc.scaleBy(0.2, 1.2);\n    const action2 = cc.scaleBy(0.3, 5 / 6);\n    //  取消悬停事件\n    this.removeMouseEnterEvent();\n    const se = cc.sequence(action1, action2, cc.callFunc(() => {\n      this.bindMouseEnterEvent();\n    }, this));\n    this.node.runAction(se);\n\n    //  发出声音\n    const soundType = this.animalType === 'tiger' ? 'tigerRoar' : 'deerSound';\n    this.node.parent.getChildByName('audioControl').getComponent('AudioControl')[soundType].play();\n    // console.log(this.node.parent.getChildByName('audioControl'));\n  },\n\n  //  鼠标移出动物后的事件\n  onMouseLeave() {\n    cc.game.canvas.style.cursor = 'default';\n  },\n\n  //  绑定鼠标悬停和移出事件事件\n  bindMouseEnterEvent() {\n    this.node.on(cc.Node.EventType.MOUSE_ENTER, this.onMouseEnter, this);\n    this.node.on(cc.Node.EventType.MOUSE_LEAVE, this.onMouseLeave, this);\n\n  },\n\n  //  移除鼠标悬停事件\n  removeMouseEnterEvent() {\n    this.node.off(cc.Node.EventType.MOUSE_ENTER, this.onMouseEnter, this);\n  },\n\n  /**\n   * 老虎吃鹿的动画\n   * @param {number} delX 横向位移量\n   * @param {number} delY 纵向位移量\n   * @return {} 动作对象\n   */\n  eatDeer({ delX, delY }) {\n    const eatAction = cc.moveBy(1, delX, delY);\n    return eatAction;\n  },\n\n  onLoad() {\n    this.bindClickEvent();\n    this.bindMouseEnterEvent();\n    // console.log(this.atLeft());\n  },\n\n  start() {\n\n  },\n\n  // update (dt) {},\n});\n"]}