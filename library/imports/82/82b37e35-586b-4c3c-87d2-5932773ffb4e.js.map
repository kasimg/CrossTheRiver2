{"version":3,"sources":["../../../../assets/Script/assets/Script/MainScript.js"],"names":["cc","Class","extends","Component","properties","animalPrefab","default","type","Prefab","tigers","deers","boat","Node","riverBankInfo","GoBtn","creatActors","i","tiger","instantiate","loader","loadRes","SpriteFrame","err","spriteFrame","getComponent","Sprite","mainScript","animalIndex","animalType","node","addChild","push","deer","setActorPos","length","posX","Data","tigerPositionLeft","x","posY","y","setPosition","deerPositionLeft","boatPositionLeft","initRiverBankInfo","left","tigerNum","deerNum","right","initBackground","bindGoEvent","on","EventType","MOUSE_DOWN","onGoBtnClicked","removeGoEvent","off","Math","abs","sailTo","ifGameOver","gameOver","removeAnimalClickEvent","removeClickEvent","bindAnimalClickEvent","bindClickEvent","pos","boatIns","boatStr","passageStr","boatSailAction","sail","delX","delY","se","sequence","callFunc","runAction","passages","seats","seatIndex","boatInfo","console","log","onLoad","start","update","dt"],"mappings":"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","file":"MainScript.js","sourceRoot":"../../../../assets/Script","sourcesContent":["// Learn cc.Class:\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/class.html\n//  - [English] http://docs.cocos2d-x.org/creator/manual/en/scripting/class.html\n// Learn Attribute:\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/reference/attributes.html\n//  - [English] http://docs.cocos2d-x.org/creator/manual/en/scripting/reference/attributes.html\n// Learn life-cycle callbacks:\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/life-cycle-callbacks.html\n//  - [English] https://www.cocos2d-x.org/docs/creator/manual/en/scripting/life-cycle-callbacks.html\nimport Data from 'static/Data';\ncc.Class({\n  extends: cc.Component,\n\n  properties: {\n    animalPrefab: {\n      default: null,\n      type: cc.Prefab,\n    },\n    // deerPrefab: {\n    //   default: null,\n    //   type: cc.Prefab,\n    // },\n    tigers: [],  //  存放3只老虎\n    deers: [],  //  存放3只鹿\n    boat: {\n      default: null,\n      type: cc.Node,\n    },\n    riverBankInfo: {},  //  存放两边岸上的情况\n    GoBtn: {\n      default: null,\n      type: cc.Node,\n    },\n  },\n\n  //  创建角色\n  creatActors() {\n    //  创建老虎\n    for (let i = 0; i < 3; i++) {\n      //  创建老虎\n      const tiger = cc.instantiate(this.animalPrefab);\n      cc.loader.loadRes('tiger', cc.SpriteFrame, (err, spriteFrame) => {\n        tiger.getComponent(cc.Sprite).spriteFrame = spriteFrame;\n      });\n\n      tiger.getComponent('Animal').mainScript = this;\n      tiger.getComponent('Animal').animalIndex = i;\n      tiger.getComponent('Animal').animalType = 'tiger';\n      this.node.addChild(tiger);\n      this.tigers.push(tiger);\n    }\n\n    //  创建鹿\n    for (let i = 0; i < 3; i++) {\n      //  创建鹿\n      const deer = cc.instantiate(this.animalPrefab);\n      cc.loader.loadRes('deer', cc.SpriteFrame, (err, spriteFrame) => {\n        deer.getComponent(cc.Sprite).spriteFrame = spriteFrame;\n      });\n\n      deer.getComponent('Animal').mainScript = this;\n      deer.getComponent('Animal').animalIndex = i;\n      deer.getComponent('Animal').animalType = 'deer';\n      this.node.addChild(deer);\n      this.deers.push(deer);\n    }\n  },\n\n  //  设置老虎和鹿的初始位置\n  setActorPos() {\n    for (let i = 0; i < this.tigers.length; i++) {\n      const tiger = this.tigers[i];\n      let posX = Data.tigerPositionLeft[i].x;\n      let posY = Data.tigerPositionLeft[i].y;\n\n      // tiger.x = posX;\n      // tiger.y = posY;\n\n      tiger.setPosition(posX, posY);\n\n      const deer = this.deers[i];\n      posX = Data.deerPositionLeft[i].x;\n      posY = Data.deerPositionLeft[i].y;\n\n      // deer.x = posX;\n      // deer.y = posY;\n      // console.log(deer.x, deer.y);\n      deer.setPosition(posX, posY);\n\n    }\n\n    //  设置船的初始位置\n    this.boat.setPosition(Data.boatPositionLeft.x, Data.boatPositionLeft.y);\n  },\n\n  //  初始化河岸数组\n  initRiverBankInfo() {\n    this.riverBankInfo = {\n      left: {\n        tigerNum: 3,\n        deerNum: 3,\n      },\n      right: {\n        tigerNum: 0,\n        deerNum: 0,\n      },\n    };\n  },\n\n  //  初始化界面\n  initBackground() {\n    this.creatActors();\n    this.setActorPos();\n    this.initRiverBankInfo();\n  },\n\n  //  绑定GO按钮点击事件\n  bindGoEvent() {\n    this.GoBtn.on(cc.Node.EventType.MOUSE_DOWN, this.onGoBtnClicked, this);\n  },\n\n  //  解除GO按钮点击事件\n  removeGoEvent() {\n    this.GoBtn.off(cc.Node.EventType.MOUSE_DOWN, this.onGoBtnClicked, this);\n  },\n\n  //  点击GO之后的事件\n  onGoBtnClicked() {\n    // console.log('点击了一次');\n    //  根据船的位置确定往哪里走，实际操作中有可能出现误差，所以这里给出一定的余地\n    if (Math.abs(this.boat.x - Data.boatPositionLeft.x) < 10) {  //  如果在左边\n      //  移动船\n      this.sailTo('right');\n      if (this.ifGameOver()) {\n        this.gameOver();\n      }\n    } else {\n      this.sailTo('left');\n    }\n  },\n\n  //  移除所有动物的点击事件\n  removeAnimalClickEvent() {\n    for (let i = 0; i < this.tigers.length; i++) {\n      this.tigers[i].getComponent('Animal').removeClickEvent();\n      this.deers[i].getComponent('Animal').removeClickEvent();\n    }\n  },\n\n  //  绑定多有动物的点击事件\n  bindAnimalClickEvent() {\n    for (let i = 0; i < this.tigers.length; i++) {\n      this.tigers[i].getComponent('Animal').bindClickEvent();\n      this.deers[i].getComponent('Animal').bindClickEvent();\n    }\n  },\n\n  //  点击按钮移动船\n  sailTo(pos) {\n    const boatIns = this.boat.getComponent('Boat');\n    const boatStr = 'boatPosition' + (pos === 'right' ? 'Right' : 'Left');\n    const passageStr = pos + 'Pos';\n    // console.log(Data[boatStr], boatStr);\n    // console.log(pos);\n    // console.log('从', {x: this.boat.x, y: this.boat.y}, '开往', Data[boatStr])\n    const boatSailAction = boatIns.sail({\n      delX: Data[boatStr].x - this.boat.x,\n      delY: Data[boatStr].y - this.boat.y,\n    });\n\n    //  移除点击事件，防止连续点击\n    this.removeGoEvent();\n    this.removeAnimalClickEvent();\n    const se = cc.sequence(boatSailAction, cc.callFunc(() => {\n      // console.log('动作执行完毕');\n      //  动作执行完之后，重新绑定事件\n      this.bindGoEvent();\n      this.bindAnimalClickEvent();\n\n      //  判断是否游戏结束\n      // if(this.ifGameOver(pos)) {\n      //   this.gameOver();\n      // } else {\n      //   console.log('继续');\n      // }\n    }, this));\n    this.boat.runAction(se);\n\n    const passages = boatIns.passages;\n    // if (!boatIns.isEmpty()) {\n    for (let i = 0; i < passages.length; i++) {\n      if (passages[i]) {\n        passages[i].sail({\n          delX: boatIns.seats[passages[i].seatIndex][passageStr].x - passages[i].node.x,\n          delY: boatIns.seats[passages[i].seatIndex][passageStr].y - passages[i].node.y,\n        });\n      }\n\n    }\n    // }\n  },\n\n  // 判定游戏是否结束\n  //  pos表示判断哪一岸的情况\n  ifGameOver(pos) {\n    const boatInfo = this.boat.getComponent('Boat');\n    console.log(boatInfo)\n    if (this.riverBankInfo[pos].tigerNum + boatInfo.boatInfo.tigerNum\n      > this.riverBankInfo[pos].deerNum + boatInfo.boatInfo.deerNum) return true;\n    return false;\n  },\n\n  //  游戏结束时执行\n  gameOver() {\n    console.log('game over');\n  },\n\n  onLoad() {\n    this.initBackground();\n    this.bindGoEvent();\n    // console.log(this.tigers[0]);\n    // console.log(this.tigers[0]);\n    // this.tigers[0].getComponent('Animal').jump();\n  },\n\n  start() {\n\n  },\n\n  update(dt) {\n    // console.log(this.tigers[0]);\n    // this.tigers[0].getComponent('Animal').jump();\n  },\n});\n"]}