{"version":3,"sources":["../../../../assets/Script/assets/Script/Animal.js"],"names":["cc","Class","extends","Component","properties","atLeft","leftPos","animalType","Data","tigerPositionLeft","animalIndex","deerPositionLeft","Math","abs","node","x","jump","delX","delY","jumpAction","moveBy","v2","easing","easeCubicActionOut","runAction","getOnTheBoatFrom","pos","boat","mainScript","getComponent","seatIndex","searchSeat","getOn","computeDelPos","y","seats","getOffTheBoatFrom","getOff","animalStr","directionStr","updateAnimalNum","bankInfo","riverBankInfo","boatInfo","addFlag","console","log","sail","sailAction","onClicked","onBoat","xBefore","yBefore","xAfter","yAfter","bindClickEvent","on","Node","EventType","MOUSE_DOWN","removeClickEvent","onLoad","start"],"mappings":"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","file":"Animal.js","sourceRoot":"../../../../assets/Script","sourcesContent":["// Learn cc.Class:\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/class.html\n//  - [English] http://docs.cocos2d-x.org/creator/manual/en/scripting/class.html\n// Learn Attribute:\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/reference/attributes.html\n//  - [English] http://docs.cocos2d-x.org/creator/manual/en/scripting/reference/attributes.html\n// Learn life-cycle callbacks:\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/life-cycle-callbacks.html\n//  - [English] https://www.cocos2d-x.org/docs/creator/manual/en/scripting/life-cycle-callbacks.html\n\nimport Data from 'static/Data';\ncc.Class({\n  extends: cc.Component,\n\n  properties: {\n\n  },\n\n  //  判断是否在左岸\n  atLeft() {\n    //  根据动物类型和创建时的索引确定左岸自己的位置\n    const leftPos = this.animalType === 'tiger'\n      ? Data.tigerPositionLeft[this.animalIndex]\n      : Data.deerPositionLeft[this.animalIndex];\n\n    if (Math.abs(this.node.x - leftPos.x) < 10) return true;\n    return false;\n  },\n\n  //  跳跃行为\n  jump({ delX = 0, delY = 0 }) {\n    // console.log('jump')\n    const jumpAction = cc\n      .moveBy(1, cc.v2(delX, delY))\n      .easing(cc.easeCubicActionOut());\n\n    this.node.runAction(jumpAction);\n    // this.computeDelPos();\n  },\n\n  //  上船行为\n  getOnTheBoatFrom(pos) {\n    const boat = this.mainScript.boat.getComponent('Boat');\n    // const bankInfo = \n    const seatIndex = boat.searchSeat();\n    if (seatIndex !== -1) {\n      boat.getOn(this, seatIndex);\n      // console.log('get on the boat');\n      //  跳上船\n      this.jump(this.computeDelPos({ x: this.node.x, y: this.node.y }, boat.seats[this.seatIndex][pos === 'left' ? 'leftPos' : 'rightPos']));\n      //  更新岸上和船上的动物数量信息\n    }\n  },\n\n  //  下船行为\n  getOffTheBoatFrom(pos) {\n    const boat = this.mainScript.boat.getComponent('Boat');\n    // console.log('get off the boat');\n    boat.getOff(this, this.seatIndex);\n\n    //  跳下船\n    const animalStr = this.animalType === 'tiger' ? 'tigerPosition' : 'deerPosition';\n    const directionStr = pos === 'left' ? 'Left' : 'Right';\n    this.jump(this.computeDelPos(\n      { x: this.node.x, y: this.node.y },\n      Data[animalStr + directionStr][this.animalIndex],\n    ));\n  },\n\n  //  更新船上和岸上的动物数量信息\n  //  getOn表示是否往船上跳，默认为true\n  updateAnimalNum(pos, getOn = true) {\n    const bankInfo = this.mainScript.riverBankInfo;\n    const boatInfo = this.mainScript.boat.getComponent('Boat').boatInfo;\n    // console.log(bankInfo, boatInfo, this.mainScript.boat.getComponent('Boat'));\n\n    const animalStr = this.animalType + 'Num';\n    const addFlag = getOn ? 1 : -1;\n    bankInfo[pos][animalStr] -= 1 * addFlag;\n    boatInfo[animalStr] += 1 * addFlag;\n\n    console.log(bankInfo, boatInfo);\n  },\n\n  //  点击GO之后的移动行为\n  sail({ delX, delY }) {\n    const sailAction = cc\n      .moveBy(1, cc.v2(delX, delY))\n      .easing(cc.easeCubicActionOut());\n\n    this.node.runAction(sailAction);\n  },\n\n  //  点击精灵的相应事件\n  //  决定是上船还是下船，应该往哪里跳\n  onClicked() {\n    // console.log('动物被点击');\n    //  存放boat\n    const boat = this.mainScript.boat.getComponent('Boat');\n    // this.atLeft();\n    // console.log(boat.atLeft());\n    //  如果船在左岸\n    // console.log(this.onBoat);\n    if (boat.atLeft()) {\n      // console.log('船在左岸');\n      // console.log(this.onBoat);\n      if (this.onBoat) {  //  此时一定是在船上，而且是在左边\n        // console.log('动物在船上');\n        this.getOffTheBoatFrom('left');\n        this.updateAnimalNum('left', false);\n      } else if (this.atLeft()) {  //  否则在岸上\n        // console.log('动物在岸上');\n        this.getOnTheBoatFrom('left');\n        this.updateAnimalNum('left');\n      }\n    } else {  //  船在右岸\n      // console.log('船在右岸');\n      if (this.onBoat) {  //  在船上，且在右边\n        this.getOffTheBoatFrom('right');\n        this.updateAnimalNum('right', false);\n      } else if (!this.atLeft()) {  //  不在船上，在右岸上\n        // console.log('动物在右岸')\n        this.getOnTheBoatFrom('right');\n        this.updateAnimalNum('right');\n      }\n    }\n  },\n\n  //  计算位移量\n  computeDelPos({ x: xBefore, y: yBefore }, { x: xAfter, y: yAfter }) {\n    return {\n      delX: xAfter - xBefore,\n      delY: yAfter - yBefore,\n    };\n  },\n\n  //  绑定鼠标点击跳跃时间\n  bindClickEvent() {\n    this.node.on(cc.Node.EventType.MOUSE_DOWN, this.onClicked, this);\n  },\n\n  //  移除鼠标点击事件\n  removeClickEvent() {\n    this.node.on(cc.Node.EventType.MOUSE_DOWN, this.onClicked, this);\n  },\n\n  // LIFE-CYCLE CALLBACKS:\n\n  onLoad() {\n    this.bindClickEvent();\n    // console.log(this.atLeft());\n  },\n\n  start() {\n\n  },\n\n  // update (dt) {},\n});\n"]}